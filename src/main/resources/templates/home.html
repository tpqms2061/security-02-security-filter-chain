<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Security Filter Chain ì‹¤ìŠµ</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 40px; background-color: #f8f9fa; }
        .container { max-width: 900px; margin: 0 auto; background: white; padding: 30px; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        .header { text-align: center; color: #333; margin-bottom: 30px; border-bottom: 2px solid #007bff; padding-bottom: 20px; }
        .info-section { background: #e3f2fd; padding: 20px; border-radius: 8px; margin-bottom: 20px; }
        .test-section { background: #f0f4f8; padding: 20px; border-radius: 8px; margin: 20px 0; }
        .navigation { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin: 20px 0; }
        .nav-button { display: block; padding: 12px 20px; background: #007bff; color: white; text-decoration: none; text-align: center; border-radius: 8px; transition: all 0.3s; }
        .nav-button:hover { background: #0056b3; transform: translateY(-1px); }
        .nav-button.public { background: #28a745; }
        .nav-button.public:hover { background: #1e7e34; }
        .nav-button.user { background: #fd7e14; }
        .nav-button.user:hover { background: #e8590c; }
        .nav-button.admin { background: #dc3545; }
        .nav-button.admin:hover { background: #c82333; }
        .status-box { background: #d4edda; border: 1px solid #c3e6cb; padding: 15px; border-radius: 5px; margin: 15px 0; }
        .logout-section { text-align: center; margin-top: 30px; padding-top: 20px; border-top: 1px solid #dee2e6; }
        .logout-button { padding: 10px 30px; background: #6c757d; color: white; border: none; border-radius: 5px; cursor: pointer; }
        .instruction { background: #fff3cd; border: 1px solid #ffeaa7; padding: 15px; border-radius: 5px; margin: 15px 0; }
    </style>
</head>
<body>
<div class="container">
    <div class="header">
        <h1>ğŸ”— Security Filter Chain ì‹¤ìŠµ</h1>
        <p>í•„í„° ì‹¤í–‰ ìˆœì„œì™€ ë³´ì•ˆ ë™ì‘ì„ ë¡œê·¸ë¡œ í™•ì¸í•´ë³´ì„¸ìš”</p>
    </div>

    <!-- í˜„ì¬ ì¸ì¦ ìƒíƒœ í‘œì‹œ -->
    <div class="status-box" th:if="${username}">
        <h3>ğŸ” í˜„ì¬ ì¸ì¦ ìƒíƒœ</h3>
        <p><strong>ì‚¬ìš©ì:</strong> <span th:text="${username}">ì‚¬ìš©ìëª…</span></p>
        <p><strong>ê¶Œí•œ:</strong>
            <span th:each="auth : ${authorities}">
                    <span th:text="${auth.authority}">ê¶Œí•œ</span>&nbsp;
                </span>
        </p>
    </div>

    <div class="status-box" th:unless="${username}">
        <h3>ğŸ‘¤ ì¸ì¦ë˜ì§€ ì•Šì€ ìƒíƒœ</h3>
        <p>ë¡œê·¸ì¸ í›„ ë” ë§ì€ ê¸°ëŠ¥ì„ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
    </div>

    <!-- í•„í„° í…ŒìŠ¤íŠ¸ ì•ˆë‚´ -->
    <div class="instruction">
        <h3>ğŸ“‹ í•„í„° ì²´ì¸ í…ŒìŠ¤íŠ¸ ë°©ë²•</h3>
        <ol>
            <li><strong>ì½˜ì†”/ë¡œê·¸ ì°½ì„ ì—´ì–´ë‘ì„¸ìš”</strong> - í•„í„° ì‹¤í–‰ ìˆœì„œë¥¼ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤</li>
            <li><strong>ì•„ë˜ ë²„íŠ¼ë“¤ì„ í´ë¦­</strong>í•˜ì—¬ ë‹¤ì–‘í•œ ê¶Œí•œ ë ˆë²¨ í…ŒìŠ¤íŠ¸</li>
            <li><strong>ë¡œê·¸ íŒ¨í„´ ê´€ì°°</strong>: ğŸ¬ ìš”ì²­ ì‹œì‘ â†’ ğŸ” í•„í„° ì‹¤í–‰ â†’ âœ… ì™„ë£Œ ìˆœì„œ</li>
            <li><strong>ì¸ì¦ ìƒíƒœì— ë”°ë¥¸</strong> í•„í„° ë™ì‘ ì°¨ì´ í™•ì¸</li>
        </ol>
    </div>

    <!-- í…ŒìŠ¤íŠ¸ ë„¤ë¹„ê²Œì´ì…˜ -->
    <div class="test-section">
        <h3>ğŸ§ª Filter Chain í…ŒìŠ¤íŠ¸</h3>
        <div class="navigation">
            <a href="/public/info" class="nav-button public">ğŸŒ ê³µê°œ í˜ì´ì§€<br><small>ì¸ì¦ ë¶ˆí•„ìš”</small></a>
            <a href="/user/profile" class="nav-button user">ğŸ‘¤ ì‚¬ìš©ì í˜ì´ì§€<br><small>USER ê¶Œí•œ í•„ìš”</small></a>
            <a href="/admin/dashboard" class="nav-button admin">ğŸ‘¨â€ğŸ’¼ ê´€ë¦¬ì í˜ì´ì§€<br><small>ADMIN ê¶Œí•œ í•„ìš”</small></a>
            <a href="/" class="nav-button">ğŸ  í™ˆ ìƒˆë¡œê³ ì¹¨<br><small>ì¸ì¦ ìƒíƒœ í™•ì¸</small></a>
        </div>
    </div>

    <!-- ë¡œê·¸ í™•ì¸ ì•ˆë‚´ -->
    <div class="info-section">
        <h3>ğŸ“Š ì˜ˆìƒë˜ëŠ” ë¡œê·¸ íŒ¨í„´</h3>
        <pre style="background: #2d3748; color: #e2e8f0; padding: 15px; border-radius: 5px; font-size: 12px; overflow-x: auto;">
ğŸ¬ [REQUEST START] GET /user/profile
ğŸ‘¤ [AUTH STATUS] Not authenticated
ğŸ” [FILTER-1] CUSTOM-EARLY BEFORE - URI: /user/profile
ğŸ” [FILTER] UsernamePasswordAuthenticationFilter ì‹¤í–‰
ğŸ” [FILTER] AuthorizationFilter ì‹¤í–‰
âŒ [SECURITY] Access Denied - ê¶Œí•œ ì—†ìŒ
ğŸ”„ Redirecting to /login
            </pre>
    </div>

    <!-- ë¡œê·¸ì•„ì›ƒ -->
    <div class="logout-section" sec:authorize="isAuthenticated()">
        <form method="post" action="/logout">
            <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>
            <button type="submit" class="logout-button">ğŸšª ë¡œê·¸ì•„ì›ƒ</button>
        </form>
    </div>
</div>
</body>
</html>
