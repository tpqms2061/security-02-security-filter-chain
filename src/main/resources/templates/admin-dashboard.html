<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>관리자 대시보드 - Filter Chain Demo</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 40px;
            background: linear-gradient(135deg, #E91E63 0%, #AD1457 100%);
            min-height: 100vh;
            color: white;
        }
        .container {
            max-width: 1100px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.95);
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            color: #333;
        }
        .header {
            text-align: center;
            color: #AD1457;
            margin-bottom: 30px;
            border-bottom: 3px solid #E91E63;
            padding-bottom: 20px;
        }
        .admin-badge {
            display: inline-block;
            background: #dc3545;
            color: white;
            padding: 6px 16px;
            border-radius: 15px;
            font-size: 14px;
            font-weight: bold;
            margin: 0 10px;
        }
        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 25px;
            margin: 30px 0;
        }
        .dashboard-card {
            background: linear-gradient(135deg, #fff 0%, #f8f9fa 100%);
            padding: 25px;
            border-radius: 15px;
            border: 1px solid #dee2e6;
            transition: all 0.3s;
            position: relative;
            overflow: hidden;
        }
        .dashboard-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(233, 30, 99, 0.15);
        }
        .dashboard-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, #E91E63, #AD1457);
        }
        .card-icon {
            font-size: 48px;
            margin-bottom: 15px;
            display: block;
        }
        .card-title {
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 10px;
            color: #AD1457;
        }
        .card-value {
            font-size: 32px;
            font-weight: bold;
            color: #E91E63;
            margin: 10px 0;
        }
        .card-description {
            color: #666;
            font-size: 14px;
            line-height: 1.4;
        }
        .security-section {
            background: #FFF3E0;
            border: 1px solid #FFB74D;
            padding: 25px;
            border-radius: 15px;
            margin: 30px 0;
        }
        .security-title {
            color: #E65100;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
        }
        .security-title::before {
            content: '🛡️';
            margin-right: 10px;
            font-size: 24px;
        }
        .filter-timeline {
            background: #E8F5E8;
            border: 1px solid #A5D6A7;
            padding: 25px;
            border-radius: 15px;
            margin: 30px 0;
        }
        .timeline-item {
            display: flex;
            align-items: center;
            padding: 12px 0;
            border-bottom: 1px solid #C8E6C9;
            position: relative;
        }
        .timeline-item:last-child {
            border-bottom: none;
        }
        .timeline-icon {
            background: #4CAF50;
            color: white;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 15px;
            font-weight: bold;
            font-size: 12px;
        }
        .admin-controls {
            background: #FFEBEE;
            border: 1px solid #FFAB91;
            padding: 25px;
            border-radius: 15px;
            margin: 30px 0;
        }
        .control-button {
            background: #E91E63;
            color: white;
            border: none;
            padding: 12px 20px;
            margin: 8px 5px;
            border-radius: 8px;
            cursor: pointer;
            transition: background 0.3s;
            font-weight: bold;
        }
        .control-button:hover {
            background: #AD1457;
        }
        .nav-buttons {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin: 30px 0;
        }
        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            text-decoration: none;
            font-weight: bold;
            transition: all 0.3s;
            cursor: pointer;
        }
        .btn-home {
            background: #007bff;
            color: white;
        }
        .btn-home:hover {
            background: #0056b3;
            transform: translateY(-2px);
        }
        .btn-user {
            background: #fd7e14;
            color: white;
        }
        .btn-user:hover {
            background: #e8590c;
            transform: translateY(-2px);
        }
        .btn-logout {
            background: #6c757d;
            color: white;
        }
        .btn-logout:hover {
            background: #545b62;
        }
        .warning-box {
            background: #FFF3CD;
            border: 1px solid #FFEAA7;
            padding: 15px;
            border-radius: 8px;
            margin: 20px 0;
            border-left: 4px solid #FFC107;
        }
        @media (max-width: 768px) {
            .dashboard-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
<div class="container">
    <div class="header">
        <h1>👨‍💼 관리자 대시보드</h1>
        <p>
            환영합니다, <strong th:text="${username ?: 'Admin'}">관리자</strong>님!
            <span class="admin-badge">ADMIN 권한</span>
        </p>
    </div>

    <!-- 대시보드 카드들 -->
    <div class="dashboard-grid">
        <div class="dashboard-card">
            <span class="card-icon">👥</span>
            <div class="card-title">총 사용자 수</div>
            <div class="card-value">2</div>
            <div class="card-description">등록된 사용자: user, admin<br>활성 세션: 1개</div>
        </div>

        <div class="dashboard-card">
            <span class="card-icon">🔐</span>
            <div class="card-title">보안 이벤트</div>
            <div class="card-value">0</div>
            <div class="card-description">오늘 로그인 실패: 0회<br>의심스러운 접근: 0회</div>
        </div>

        <div class="dashboard-card">
            <span class="card-icon">📊</span>
            <div class="card-title">시스템 상태</div>
            <div class="card-value" style="color: #4CAF50;">정상</div>
            <div class="card-description">모든 서비스 정상 작동<br>업타임: 99.9%</div>
        </div>

        <div class="dashboard-card">
            <span class="card-icon">🚀</span>
            <div class="card-title">필터 체인</div>
            <div class="card-value">17</div>
            <div class="card-description">활성 보안 필터 개수<br>평균 응답시간: 12ms</div>
        </div>
    </div>

    <!-- 보안 정보 -->
    <div class="security-section">
        <h3 class="security-title">관리자 전용 보안 정보</h3>
        <div class="warning-box">
            <strong>⚠️ 중요:</strong> 이 페이지는 ADMIN 권한을 가진 사용자만 접근할 수 있습니다.
            일반 USER 권한으로는 접근이 차단됩니다.
        </div>
        <ul>
            <li><strong>접근 제어:</strong> <code>.requestMatchers("/admin/**").hasRole("ADMIN")</code></li>
            <li><strong>권한 검증:</strong> AuthorizationFilter에서 ADMIN 역할 확인</li>
            <li><strong>실패 시 처리:</strong> 403 Forbidden 또는 로그인 페이지로 리다이렉트</li>
        </ul>
    </div>

    <!-- 필터 실행 타임라인 -->
    <div class="filter-timeline">
        <h3 style="color: #2E7D32; margin-bottom: 20px;">🔗 이 페이지 접근 시 필터 실행 순서</h3>
        <div class="timeline-item">
            <div class="timeline-icon">1</div>
            <div>
                <strong>SecurityContextHolderFilter</strong><br>
                <small>현재 사용자의 인증 정보를 SecurityContext에 로드</small>
            </div>
        </div>
        <div class="timeline-item">
            <div class="timeline-icon">2</div>
            <div>
                <strong>CsrfFilter</strong><br>
                <small>CSRF 토큰 검증 (GET 요청이므로 통과)</small>
            </div>
        </div>
        <div class="timeline-item">
            <div class="timeline-icon">3</div>
            <div>
                <strong>UsernamePasswordAuthenticationFilter</strong><br>
                <small>이미 인증된 사용자이므로 스킵</small>
            </div>
        </div>
        <div class="timeline-item">
            <div class="timeline-icon">4</div>
            <div>
                <strong>AuthorizationFilter</strong><br>
                <small><strong>ADMIN 권한 확인 ✅ 통과!</strong></small>
            </div>
        </div>
        <div class="timeline-item">
            <div class="timeline-icon">5</div>
            <div>
                <strong>Controller 실행</strong><br>
                <small>AdminDashboard 페이지 렌더링</small>
            </div>
        </div>
    </div>

    <!-- 관리자 컨트롤 -->
    <div class="admin-controls">
        <h3 style="color: #C62828; margin-bottom: 15px;">⚙️ 관리자 기능</h3>
        <p style="margin-bottom: 15px;">실제 운영 환경에서는 다음과 같은 기능들이 제공됩니다:</p>
        <button class="control-button" onclick="showAlert('사용자 관리')">👥 사용자 관리</button>
        <button class="control-button" onclick="showAlert('시스템 설정')">⚙️ 시스템 설정</button>
        <button class="control-button" onclick="showAlert('보안 로그')">📋 보안 로그</button>
        <button class="control-button" onclick="showAlert('권한 관리')">🔐 권한 관리</button>
    </div>

    <!-- 네비게이션 -->
    <div class="nav-buttons">
        <a href="/" class="btn btn-home">🏠 홈으로</a>
        <a href="/user/profile" class="btn btn-user">👤 사용자 프로필</a>
    </div>

    <!-- 로그아웃 -->
    <div style="text-align: center; margin-top: 30px;" sec:authorize="isAuthenticated()">
        <form method="post" action="/logout" style="display: inline;">
            <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>
            <button type="submit" class="btn btn-logout">🚪 로그아웃</button>
        </form>
    </div>

    <div style="text-align: center; margin-top: 20px; color: #666; font-size: 14px;">
        <p>🛡️ 최고 보안 등급 - ADMIN 권한 보유자만 접근 가능</p>
    </div>
</div>

<script>
    function showAlert(feature) {
        alert(`${feature} 기능은 데모 버전에서는 제공되지 않습니다.\n실제 운영 환경에서 구현됩니다.`);
    }

    // 실시간 시간 업데이트
    function updateTime() {
        const now = new Date();
        const timeElement = document.querySelector('.card-description');
        // 간단한 실시간 효과를 위해 페이지 로드 시간 표시
    }

    // 페이지 로드 시 실행
    document.addEventListener('DOMContentLoaded', function() {
        updateTime();
    });
</script>
<!--업데이트 타임 해 가지고요 페이지로드 됐을 때 시간 찍음-->
</body>
</html>